<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para Rebeca ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400;1,600&family=Montserrat:wght@300;500&display=swap" rel="stylesheet">
    <style>
        /* --- VARIABLES Y CONFIGURACI√ìN --- */
        :root {
            --primary-color: #d45d79;   /* Rosa profundo */
            --accent-color: #ea90b0;    /* Rosa pastel suave */
            --bg-start: #fff0f3;
            --bg-end: #ffe4e9;
            --text-main: #4a4a4a;
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(255, 255, 255, 0.4);
            --shadow-soft: 0 10px 40px rgba(212, 93, 121, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: "Cormorant Garamond", serif;
            background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%);
            min-height: 100vh;
            overflow-x: hidden;
            color: var(--text-main);
            position: relative;
        }

        /* --- TEXTURA DE RUIDO (Efecto Papel/Cine) --- */
        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
            opacity: 0.04;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* --- FONDO DE CORAZONES --- */
        .hearts-background {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .bg-heart {
            position: absolute;
            color: var(--accent-color);
            opacity: 0;
            animation: floatBackground 12s ease-in-out infinite;
            bottom: -50px;
            filter: blur(1px);
        }

        @keyframes floatBackground {
            0% { transform: translateY(0) rotate(0deg) translateX(0); opacity: 0; }
            20% { opacity: 0.6; }
            50% { transform: translateY(-50vh) rotate(180deg) translateX(20px); opacity: 0.4; }
            100% { transform: translateY(-110vh) rotate(360deg) translateX(-20px); opacity: 0; }
        }

        /* --- LAYOUT PRINCIPAL --- */
        .container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            z-index: 2;
            perspective: 1000px;
        }

        /* --- SOBRE MEJORADO --- */
        .envelope-wrapper {
            position: relative;
            cursor: pointer;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .envelope-wrapper:hover {
            transform: scale(1.03) rotate(1deg);
        }

        .envelope {
            width: 320px;
            height: 220px;
            background: #ff6b81;
            position: relative;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 20px 45px rgba(0,0,0,0.15);
            z-index: 2;
        }

        .envelope::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 160px solid transparent;
            border-right: 160px solid transparent;
            border-top: 110px solid #ff8597;
            z-index: 1;
        }

        .envelope::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 160px solid #d45d79;
            border-right: 160px solid #d45d79;
            border-bottom: 110px solid transparent;
            border-radius: 0 0 12px 12px;
            z-index: 3;
            transform: rotate(180deg);
            top: auto;
            bottom: 0;
        }

        .flap {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 160px solid transparent;
            border-right: 160px solid transparent;
            border-top: 120px solid #ff6b81;
            z-index: 4;
            transform-origin: top;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1), z-index 0.2s;
        }

        /* Sello de Cera */
        .seal {
            position: absolute;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            width: 45px;
            height: 45px;
            background: #c0392b;
            border-radius: 50%;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: rgba(255,255,255,0.8);
            box-shadow: 0 4px 6px rgba(0,0,0,0.2), inset 0 2px 5px rgba(255,255,255,0.2);
            border: 2px dashed rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .envelope-wrapper:hover .seal {
            transform: translateX(-50%) scale(1.1);
        }

        .envelope-wrapper.open .flap {
            transform: rotateX(180deg);
            z-index: 1;
        }
        
        .envelope-wrapper.open .envelope {
            animation: fallAndFade 1.2s forwards ease-in-out;
        }

        @keyframes fallAndFade {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(300px) scale(0.8); opacity: 0; pointer-events: none; }
        }

        .click-instruction {
            margin-top: 40px;
            color: var(--primary-color);
            font-family: 'Montserrat', sans-serif;
            font-size: 0.8rem;
            letter-spacing: 3px;
            text-transform: uppercase;
            font-weight: 500;
            animation: pulseText 2s infinite;
        }

        @keyframes pulseText {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; letter-spacing: 4px; }
        }

        /* --- CARTA (Glassmorphism) --- */
        .letter-container {
            display: none;
            width: 100%;
            max-width: 650px;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            padding: 50px;
            border-radius: 20px;
            box-shadow: var(--shadow-soft);
            animation: slideUpFade 1.2s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
            margin: 20px 0 60px 0;
        }

        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(60px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .letter-header h1 {
            font-family: "Great Vibes", cursive;
            font-size: 3.8rem;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 5px;
            line-height: 1.2;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.5);
        }

        .date {
            text-align: center;
            color: #888;
            font-size: 1rem;
            margin-bottom: 40px;
            font-style: italic;
            font-family: "Cormorant Garamond", serif;
            position: relative;
        }
        
        .date::after {
            content: '';
            display: block;
            width: 50px;
            height: 1px;
            background: var(--accent-color);
            margin: 10px auto 0;
        }

        /* --- TEXTO DE LA CARTA (Normalizado) --- */
        .letter-content p {
            font-size: 1.3rem;
            line-height: 1.7;
            color: #3d3d3d;
            margin-bottom: 25px;
            text-align: justify;
            font-weight: 400;
            /* Se elimin√≥ el estilo de letra capital rosa */
        }

        .highlight {
            color: var(--primary-color);
            font-weight: 600;
            background: linear-gradient(to top, rgba(255, 182, 193, 0.3) 0%, transparent 40%);
        }

        /* --- CARRUSEL TIPO POLAROID --- */
        .photo-carousel {
            margin: 40px 0;
            position: relative;
            background: transparent;
            text-align: center;
        }

        .carousel-caption {
            font-family: 'Great Vibes', cursive;
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .polaroid-frame {
            background: #fff;
            padding: 12px 12px 35px 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            transform: rotate(-1deg);
            transition: transform 0.3s;
            display: inline-block;
            max-width: 100%;
        }
        
        .polaroid-frame:hover {
            transform: rotate(0deg) scale(1.01);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .carousel-track {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            position: relative;
            overflow: hidden;
        }

        .carousel-media {
            max-width: 100%;
            max-height: 350px;
            display: none;
            opacity: 0;
            object-fit: cover;
            border-radius: 2px;
            filter: sepia(10%);
        }

        .carousel-media.active {
            display: block;
            animation: softFade 1.5s ease forwards;
        }

        @keyframes softFade {
            0% { opacity: 0; filter: blur(5px) sepia(10%); }
            100% { opacity: 1; filter: blur(0) sepia(10%); }
        }

        /* --- FIRMA --- */
        .signature {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(212, 93, 121, 0.2);
            position: relative;
        }
        
        .signature::before {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-start);
            padding: 0 10px;
            font-size: 0.8rem;
            color: var(--accent-color);
            letter-spacing: 2px;
        }

        .signature p {
            font-family: "Great Vibes", cursive;
            font-size: 2.5rem;
            color: var(--primary-color);
            margin: 5px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }
        
        .signature em {
            font-family: "Montserrat", sans-serif;
            font-size: 0.9rem;
            color: #777;
            letter-spacing: 1px;
            display: block;
            margin-top: 5px;
        }

        /* --- BOT√ìN M√öSICA --- */
        .music-btn {
            position: fixed;
            top: 25px;
            right: 25px;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(5px);
            border-radius: 50%;
            border: 1px solid var(--accent-color);
            color: var(--primary-color);
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .music-btn:hover {
            transform: scale(1.1);
            background: #fff;
            box-shadow: 0 0 20px rgba(212, 93, 121, 0.4);
        }

        .music-btn.playing {
            border-color: var(--primary-color);
            animation: pulseMusic 2s infinite;
        }

        @keyframes pulseMusic {
            0% { box-shadow: 0 0 0 0 rgba(212, 93, 121, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(212, 93, 121, 0); }
            100% { box-shadow: 0 0 0 0 rgba(212, 93, 121, 0); }
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 600px) {
            .letter-container { padding: 30px 20px; width: 92%; }
            .envelope-wrapper { transform: scale(0.85); }
            .letter-header h1 { font-size: 2.8rem; }
            .letter-content p { font-size: 1.15rem; }
        }
    </style>
</head>
<body>

    <div class="noise-overlay"></div>
    <div class="hearts-background" id="bgHearts"></div>

    <audio id="backgroundMusic" loop>
        <source src="Musica.mp3" type="audio/mpeg">
    </audio>

    <button id="musicToggle" class="music-btn" aria-label="Play Music">üéµ</button>

    <div class="container">
        
        <div class="envelope-wrapper" id="envelopeWrapper">
            <div class="flap"></div>
            <div class="envelope">
                <div class="seal">‚ù§</div>
            </div>
            <div class="click-instruction" id="instruction">Toca para abrir</div>
        </div>

        <div class="letter-container" id="letter">
            <div class="letter-header">
                <h1>Para Rebeca</h1>
                <div class="date">De mi coraz√≥n al tuyo</div>
            </div>

            <div class="letter-content">
                <p>Mi amor, jajaj es algo gracioso para mi por que recuerdo cuando te escrib√≠ esta carta por primera vez recuerdo el miedo recuerdo la duda pero ahora no puedo imaginarme sin ti es increible cuanto te amo cuan feliz me haces y como en tan poco tiempo me cambiaste la vida completamente no se como le hiciste pero me encanta que lo hayas hecho la verdad mi amor ya no puedo imaginarme sin ti, eres el amor de mi vida y solo queria decirte que..</p>

                <p>Ahora que te tengo en mi vida ahora que eres mi ni√±a mi amor mi vida mi mujeeee jasjaj ‚ù§Ô∏è, todo tiene un color diferente. Eres mi paz en los d√≠as ca√≥ticos y mi alegr√≠a en los d√≠as grises. Ya no se trata de "ver qu√© pasa", porque contigo lo tengo claro: <span class="highlight">te elijo a ti</span>. Te elijo hoy, te elijo ma√±ana y te seguir√© eligiendo en cada paso que demos.</p>

                <p>Quiero construir algo hermoso contigo, algo real y duradero. Quiero ser quien te apoye en tus sue√±os, quien te cuide y quien te haga re√≠r hasta que te duela la panza. Eres lo m√°s bonito e importante que me ha pasado, y prometo cuidarnos siempre.</p>

                <div class="photo-carousel">
                    <div class="carousel-caption">‚ú®</div>
                    <div class="polaroid-frame">
                        <div class="carousel-track" id="carouselTrack">
                            <img src="foto1.jpg" class="carousel-media active" onerror="this.style.display='none'">
                            <video src="video1.mp4" class="carousel-media" muted playsinline onerror="this.style.display='none'"></video>
                            <img src="foto2.jpg" class="carousel-media" onerror="this.style.display='none'">
                            <video src="video2.mp4" class="carousel-media" muted playsinline onerror="this.style.display='none'"></video>
                            <img src="foto3.jpg" class="carousel-media" onerror="this.style.display='none'">
                            <video src="video3.mp4" class="carousel-media" muted playsinline onerror="this.style.display='none'"></video>
                            <img src="foto4.jpg" class="carousel-media" onerror="this.style.display='none'">
                            <video src="video4.mp4" class="carousel-media" muted playsinline onerror="this.style.display='none'"></video>
                            <img src="foto5.jpg" class="carousel-media" onerror="this.style.display='none'">
                            <video src="video5.mp4" class="carousel-media" muted playsinline onerror="this.style.display='none'"></video>
                        </div>
                    </div>
                </div>

                <p>Gracias por dejarme ser parte de tu vida y por convertirte en la parte m√°s esencial de la m√≠a. No s√© qu√© nos depare el futuro, pero mientras sea de tu mano, s√© que ser√° maravilloso.</p>

                <p style="text-align: center; margin-top: 30px;"><span class="highlight">Te amo con todo mi coraz√≥n.</span></p>

                <div class="signature">
                    <p>Con amor ‚ù§</p>
                    <em>Tu Novio el loquillo ü§™ü•¥‚ú®</em>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const envelopeWrapper = document.getElementById("envelopeWrapper");
            const letter = document.getElementById("letter");
            const instruction = document.getElementById("instruction");
            const musicToggle = document.getElementById("musicToggle");
            const backgroundMusic = document.getElementById("backgroundMusic");
            const bgHearts = document.getElementById("bgHearts");
            
            let isOpened = false;
            let musicPlaying = false;

            // --- APERTURA ---
            envelopeWrapper.addEventListener("click", () => {
                if (!isOpened) {
                    isOpened = true;
                    envelopeWrapper.classList.add("open");
                    instruction.style.opacity = "0";
                    playMusic();
                    setTimeout(() => {
                        envelopeWrapper.style.display = "none";
                        letter.style.display = "block";
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        createBurstHearts();
                        scheduleNextSlide();
                    }, 1000);
                }
            });

            // --- M√öSICA ---
            musicToggle.addEventListener("click", () => {
                if (musicPlaying) {
                    backgroundMusic.pause();
                    musicToggle.textContent = "üéµ";
                    musicToggle.classList.remove("playing");
                    musicPlaying = false;
                } else {
                    playMusic();
                }
            });

            function playMusic() {
                backgroundMusic.volume = 0.5;
                backgroundMusic.play().then(() => {
                    musicToggle.textContent = "üé∂";
                    musicToggle.classList.add("playing");
                    musicPlaying = true;
                }).catch(() => console.log("Audio requiere interacci√≥n"));
            }

            // --- FONDO ANIMADO ---
            function createFloatingHearts() {
                const colors = ["#d45d79", "#ea90b0", "#ffcad4"];
                const heart = document.createElement("div");
                heart.classList.add("bg-heart");
                heart.innerHTML = "‚ù§";
                heart.style.left = Math.random() * 100 + "vw";
                heart.style.fontSize = (Math.random() * 20 + 15) + "px";
                heart.style.color = colors[Math.floor(Math.random() * colors.length)];
                heart.style.animationDuration = (Math.random() * 5 + 10) + "s";
                bgHearts.appendChild(heart);
                setTimeout(() => { heart.remove(); }, 15000);
            }
            setInterval(createFloatingHearts, 800);

            // --- CLICK CORAZ√ìN ---
            const addHeart = (x, y) => {
                const heart = document.createElement('div');
                heart.innerHTML = "‚ù§";
                heart.style.position = 'fixed';
                heart.style.left = x + 'px';
                heart.style.top = y + 'px';
                heart.style.color = '#d45d79';
                heart.style.fontSize = '1.5rem';
                heart.style.pointerEvents = 'none';
                heart.style.zIndex = '9999';
                heart.style.transform = 'translate(-50%, -50%)';
                heart.style.animation = 'floatAndFade 1s ease-out forwards';
                // Fallback animation inline
                heart.animate([
                    { transform: 'translate(-50%, -50%) scale(0.5)', opacity: 1 },
                    { transform: 'translate(-50%, -150%) scale(1.5)', opacity: 0 }
                ], { duration: 1000, easing: 'ease-out' });
                document.body.appendChild(heart);
                setTimeout(() => heart.remove(), 1000);
            };

            document.addEventListener('click', (e) => {
                if(e.target.closest('button') || e.target.closest('.envelope-wrapper')) return;
                addHeart(e.clientX, e.clientY);
            });

            // --- CARRUSEL ---
            const slides = document.querySelectorAll('.carousel-media');
            let currentIndex = 0;
            let slideTimeout;

            function showNextSlide() {
                let nextIndex = currentIndex + 1;
                if (nextIndex >= slides.length) nextIndex = 0;
                
                const currentSlide = slides[currentIndex];
                currentSlide.classList.remove('active');
                if(currentSlide.tagName === 'VIDEO') {
                    currentSlide.pause();
                    currentSlide.currentTime = 0;
                }

                currentIndex = nextIndex;
                const nextSlide = slides[currentIndex];
                
                if(nextSlide.style.display === 'none') {
                     setTimeout(showNextSlide, 50);
                     return;
                }
                nextSlide.classList.add('active');
                scheduleNextSlide();
            }

            function scheduleNextSlide() {
                if(!isOpened) return; 
                const currentSlide = slides[currentIndex];
                if(slideTimeout) clearTimeout(slideTimeout);

                if (currentSlide.tagName === 'VIDEO') {
                    currentSlide.play().then(() => {
                        currentSlide.onended = () => showNextSlide();
                    }).catch(() => {
                        slideTimeout = setTimeout(showNextSlide, 3000);
                    });
                } else {
                    slideTimeout = setTimeout(showNextSlide, 5000);
                }
            }

            // Swipe
            let touchStartX = 0;
            const track = document.getElementById('carouselTrack');
            track.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
                if(slideTimeout) clearTimeout(slideTimeout);
            }, {passive: true});

            track.addEventListener('touchend', e => {
                if (e.changedTouches[0].screenX < touchStartX - 50) {
                    const currentSlide = slides[currentIndex];
                    if(currentSlide.tagName === 'VIDEO') {
                        currentSlide.pause();
                        currentSlide.currentTime = 0;
                        currentSlide.onended = null;
                    }
                    showNextSlide();
                }
            }, {passive: true});

            // --- EXPLOSI√ìN DE CORAZONES ---
            function createBurstHearts() {
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        const heart = document.createElement("div");
                        heart.innerHTML = "üíñ";
                        heart.style.position = "fixed";
                        heart.style.left = "50%";
                        heart.style.top = "50%";
                        heart.style.fontSize = (Math.random() * 20 + 20) + "px";
                        heart.style.zIndex = "1000";
                        const angle = Math.random() * Math.PI * 2;
                        const velocity = Math.random() * 200 + 100;
                        const tx = Math.cos(angle) * velocity;
                        const ty = Math.sin(angle) * velocity;
                        heart.animate([
                            { transform: 'translate(-50%, -50%) scale(0)', opacity: 1 },
                            { transform: `translate(calc(-50% + ${tx}px), calc(-50% + ${ty}px)) scale(1)`, opacity: 0 }
                        ], { duration: 1500, easing: 'cubic-bezier(0, .9, .57, 1)' }).onfinish = () => heart.remove();
                        document.body.appendChild(heart);
                    }, i * 50);
                }
            }
        });
    </script>
</body>

</html>
