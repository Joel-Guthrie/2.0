<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para Rebeca ‚ù§Ô∏è</title>
    <!-- Fuentes de Google -->
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Montserrat:wght@300;500&display=swap" rel="stylesheet">
    <style>
        /* --- RESET Y ESTILOS BASE --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Crimson Text", serif;
            background: linear-gradient(135deg, #fff0f5 0%, #ffe4e1 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- FONDO ANIMADO --- */
        .hearts-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .bg-heart {
            position: absolute;
            color: rgba(255, 182, 193, 0.4);
            animation: floatBackground 15s linear infinite;
            bottom: -50px;
        }

        @keyframes floatBackground {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            50% { opacity: 0.8; }
            100% { transform: translateY(-120vh) rotate(360deg); opacity: 0; }
        }

        /* --- CONTENEDOR PRINCIPAL --- */
        .container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        /* --- SOBRE (ENVELOPE) --- */
        .envelope-wrapper {
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .envelope-wrapper:hover {
            transform: scale(1.02);
        }

        .envelope {
            width: 300px;
            height: 200px;
            background: #ff5e6c;
            position: relative;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 2;
        }

        .envelope::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-top: 100px solid #ff7a85;
            z-index: 1;
        }

        .envelope::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 150px solid #ff4757;
            border-right: 150px solid #ff4757;
            border-bottom: 100px solid transparent;
            border-radius: 0 0 10px 10px;
            z-index: 3;
        }

        .flap {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-top: 110px solid #ff5e6c;
            z-index: 4;
            transform-origin: top;
            transition: transform 0.6s ease, z-index 0.2s;
        }

        .seal {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            z-index: 5;
            transition: transform 0.3s;
        }
        
        .envelope-wrapper:hover .seal {
            transform: translateX(-50%) scale(1.2);
        }

        .envelope-wrapper.open .flap {
            transform: rotateX(180deg);
            z-index: 1;
        }
        
        .envelope-wrapper.open .envelope {
            animation: fallDown 1s forwards;
        }

        @keyframes fallDown {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(200px) scale(0.5); opacity: 0; display: none; }
        }

        .click-instruction {
            margin-top: 30px;
            color: #ff4757;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* --- CARTA ABIERTA --- */
        .letter-container {
            display: none;
            width: 100%;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(233, 30, 99, 0.15);
            position: relative;
            animation: slideUp 1s ease forwards;
            margin-top: 20px;
            margin-bottom: 50px;
            border: 1px solid rgba(233, 30, 99, 0.1);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .letter-header h1 {
            font-family: "Great Vibes", cursive;
            font-size: 3rem;
            color: #d63384;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.05);
        }

        .date {
            text-align: center;
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 30px;
            font-style: italic;
        }

        .letter-content p {
            font-size: 1.15rem;
            line-height: 1.8;
            color: #4a4a4a;
            margin-bottom: 20px;
            text-align: justify;
        }
        .letter-content,
        .letter-content * {
           font-family: "Crimson Text", serif !important;
        }

        .highlight {
            color: #d63384;
            font-weight: 600;
        }

        /* --- RULETA DE FOTOS Y VIDEOS --- */
        .photo-carousel {
            margin: 30px 0;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            background: #fff;
            padding: 10px;
            text-align: center;
        }

        .carousel-caption {
            font-family: 'Great Vibes', cursive;
            color: #d63384;
            font-size: 1.6rem;
            margin-bottom: 5px;
        }
        
        .carousel-subcaption {
            font-size: 0.8rem;
            color: #aaa;
            margin-bottom: 10px;
            font-style: italic;
        }

        .carousel-track {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 350px;
            background: #f8f9fa;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            touch-action: pan-y; 
            cursor: grab;
        }
        
        .carousel-track:active {
            cursor: grabbing;
        }

        .carousel-media {
            max-width: 100%;
            max-height: 350px;
            border-radius: 5px;
            display: none;
            opacity: 0;
            object-fit: contain;
            pointer-events: none;
        }

        /* EFECTO DE TRANSICI√ìN SUAVE (FADE + SCALE) */
        .carousel-media.active {
            display: block;
            animation: fadeInScale 0.8s ease forwards;
        }

        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.95);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* --- FIRMA --- */
        .signature {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ffccd5;
        }

        .signature p {
            font-family: "Great Vibes", cursive;
            font-size: 2.2rem;
            color: #d63384;
            margin: 5px 0;
        }

        /* --- EFECTO CLICK CORAZ√ìN --- */
        .click-heart {
            position: fixed;
            font-size: 1.5rem;
            pointer-events: none;
            animation: floatAndFade 1s ease-out forwards;
            z-index: 9999;
        }

        @keyframes floatAndFade {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            50% { transform: translate(-50%, -100%) scale(1.2); opacity: 0.8; }
            100% { transform: translate(-50%, -200%) scale(1.5); opacity: 0; }
        }

        /* --- CONTROLES M√öSICA --- */
        .music-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 45px;
            height: 45px;
            background: white;
            border-radius: 50%;
            border: 2px solid #ff5e6c;
            color: #ff5e6c;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .music-btn:hover {
            transform: scale(1.1);
            background: #ff5e6c;
            color: white;
        }

        .music-btn.playing {
            animation: rotateMusic 3s linear infinite;
        }

        @keyframes rotateMusic {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 600px) {
            .letter-container { padding: 25px; margin: 10px; width: 95%; }
            .envelope-wrapper { transform: scale(0.8); }
            .letter-header h1 { font-size: 2.2rem; }
            .carousel-track { min-height: 250px; }
            .carousel-media { max-height: 250px; }
        }
    </style>
</head>
<body>

    <!-- Fondo -->
    <div class="hearts-background" id="bgHearts"></div>

    <!-- Audio -->
    <audio id="backgroundMusic" loop>
        <source src="Musica.mp3" type="audio/mpeg">
    </audio>

    <button id="musicToggle" class="music-btn">üéµ</button>

    <div class="container">
        
        <!-- Sobre -->
        <div class="envelope-wrapper" id="envelopeWrapper">
            <div class="flap"></div>
            <div class="envelope">
                <div class="seal">‚ù§Ô∏è</div>
            </div>
            <div class="click-instruction" id="instruction">Toca el sobre para abrir</div>
        </div>

        <!-- Carta -->
        <div class="letter-container" id="letter">
            <div class="letter-header">
                <h1>Para Rebeca ‚ù§Ô∏è</h1>
                <div class="date">De mi coraz√≥n al tuyo</div>
            </div>

            <div class="letter-content">
                <p>Mi amor, jajaj es algo gracioso para mi por que recuerdo cuando te escrib√≠ esta carta por primera vez recuerdo el miedo recuerdo la duda pero ahora no puedo imaginarme sin ti es increible cuanto te amo cuan feliz me haces y como en tan poco tiempo me cambiaste la vida completamente no se como le hiciste pero me encanta que lo hayas hecho la verdad mi amor ya no puedo imaginarme sin ti, eres el amor de mi vida y solo queria decirte que..</p>

                <p>Ahora que te tengo en mi vida ahora que eres mi ni√±a mi amor mi vida mi mujeeee jasjaj ‚ù§Ô∏è, todo tiene un color diferente. Eres mi paz en los d√≠as ca√≥ticos y mi alegr√≠a en los d√≠as grises. Ya no se trata de "ver qu√© pasa", porque contigo lo tengo claro: <span class="highlight">te elijo a ti</span>. Te elijo hoy, te elijo ma√±ana y te seguir√© eligiendo en cada paso que demos.</p>

                <p>Quiero construir algo hermoso contigo, algo real y duradero. Quiero ser quien te apoye en tus sue√±os, quien te cuide y quien te haga re√≠r hasta que te duela la panza. Eres lo m√°s bonito e importante que me ha pasado, y prometo cuidarnos siempre.</p>

                <!-- CARRUSEL (Fotos y Videos Intercalados) -->
                <div class="photo-carousel">
                    <div class="carousel-caption">‚ú®‚ù§</div>
                    <div class="carousel-track" id="carouselTrack">
                        
                        <!-- 1. Foto -->
                        <img src="foto1.jpg" class="carousel-media active" onerror="this.style.display='none'">
                        
                        <!-- 1. Video -->
                        <video src="video1.mp4" class="carousel-media" muted playsinline onerror="this.style.display='none'"></video>
                        
                        <!-- 2. Foto -->
                        <img src="foto2.jpg" class="carousel-media" onerror="this.style.display='none'">
                        
                        <!-- 2. Video -->
                        <video src="video2.mp4" class="carousel-media" muted playsinline onerror="this.style.display='none'"></video>
                        
                        <!-- 3. Foto -->
                        <img src="foto3.jpg" class="carousel-media" onerror="this.style.display='none'">

                         <!-- 3. Video -->
                         <video src="video3.mp4" class="carousel-media" muted playsinline onerror="this.style.display='none'"></video>

                        <!-- 4. Foto -->
                        <img src="foto4.jpg" class="carousel-media" onerror="this.style.display='none'">

                         <!-- 4. Video -->
                         <video src="video4.mp4" class="carousel-media" muted playsinline onerror="this.style.display='none'"></video>

                        <!-- 5. Foto -->
                        <img src="foto5.jpg" class="carousel-media" onerror="this.style.display='none'">

                         <!-- 5. Video -->
                         <video src="video5.mp4" class="carousel-media" muted playsinline onerror="this.style.display='none'"></video>
                        
                        <p id="noPhotosMsg" style="display:none; color:#999; font-size:0.8rem; margin:auto;">(Cargando recuerdos...)</p>
                    </div>
                </div>

                <p>Gracias por dejarme ser parte de tu vida y por convertirte en la parte m√°s esencial de la m√≠a. No s√© qu√© nos depare el futuro, pero mientras sea de tu mano, s√© que ser√° maravilloso.</p>

                <p class="final-message"><span class="highlight">Te amo con todo mi coraz√≥n mi amor.</span></p>

                <div class="signature">
                    <p><strong>Con amor ‚ù§Ô∏è</strong></p>
                    <p><em>Tu Novio el loquillo ü§™ü•¥‚ú®</em></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const envelopeWrapper = document.getElementById("envelopeWrapper");
            const letter = document.getElementById("letter");
            const instruction = document.getElementById("instruction");
            const musicToggle = document.getElementById("musicToggle");
            const backgroundMusic = document.getElementById("backgroundMusic");
            const bgHearts = document.getElementById("bgHearts");
            
            // --- 1. L√ìGICA GENERAL ---
            let isOpened = false;
            let musicPlaying = false;

            envelopeWrapper.addEventListener("click", () => {
                if (!isOpened) {
                    isOpened = true;
                    envelopeWrapper.classList.add("open");
                    instruction.style.display = "none";
                    
                    setTimeout(() => {
                        envelopeWrapper.style.display = "none";
                        letter.style.display = "block";
                        playMusic();
                        createConfettiHearts();
                        // Iniciar el carrusel solo cuando se abre la carta
                        scheduleNextSlide();
                    }, 800);
                }
            });

            musicToggle.addEventListener("click", () => {
                if (musicPlaying) {
                    backgroundMusic.pause();
                    musicToggle.textContent = "üéµ";
                    musicToggle.classList.remove("playing");
                    musicPlaying = false;
                } else {
                    playMusic();
                }
            });

            function playMusic() {
                backgroundMusic.play().then(() => {
                    musicToggle.textContent = "üé∂";
                    musicToggle.classList.add("playing");
                    musicPlaying = true;
                }).catch(e => console.log("Audio requiere interacci√≥n"));
            }

            // --- 2. FONDO ANIMADO ---
            function createFloatingHearts() {
                const colors = ["‚ù§Ô∏è", "üíñ", "üíï", "üíó"];
                const heart = document.createElement("div");
                heart.classList.add("bg-heart");
                heart.innerHTML = colors[Math.floor(Math.random() * colors.length)];
                heart.style.left = Math.random() * 100 + "vw";
                heart.style.fontSize = (Math.random() * 20 + 10) + "px";
                heart.style.animationDuration = (Math.random() * 10 + 5) + "s";
                bgHearts.appendChild(heart);
                setTimeout(() => { heart.remove(); }, 15000);
            }
            setInterval(createFloatingHearts, 500);

            // --- 3. EFECTO CLICK CORAZ√ìN ---
            const addHeart = (x, y) => {
                const heart = document.createElement('div');
                heart.classList.add('click-heart');
                heart.innerHTML = "‚ù§Ô∏è";
                heart.style.left = x + 'px';
                heart.style.top = y + 'px';
                const randomRotate = Math.random() * 40 - 20; 
                heart.style.transform = `translate(-50%, -50%) rotate(${randomRotate}deg)`;
                document.body.appendChild(heart);
                setTimeout(() => heart.remove(), 1000);
            };

            document.addEventListener('click', (e) => {
                if(e.target.closest('button') || e.target.closest('.envelope-wrapper')) return;
                addHeart(e.clientX, e.clientY);
            });

            document.addEventListener('touchstart', (e) => {
                const touch = e.touches[0];
                addHeart(touch.clientX, touch.clientY);
            }, {passive: true});

            // --- 4. CARRUSEL INTELIGENTE (TIEMPOS VARIABLES) ---
            const slides = document.querySelectorAll('.carousel-media');
            const track = document.getElementById('carouselTrack');
            let currentIndex = 0;
            let slideTimeout;

            function showNextSlide() {
                // Calcular siguiente √≠ndice
                let nextIndex = currentIndex + 1;
                if (nextIndex >= slides.length) nextIndex = 0;
                
                // Ocultar actual
                const currentSlide = slides[currentIndex];
                currentSlide.classList.remove('active');
                if(currentSlide.tagName === 'VIDEO') {
                    currentSlide.pause();
                    currentSlide.currentTime = 0;
                }

                // Mostrar siguiente (buscando uno visible)
                // Nota: Asumimos que los archivos existen. Si no, el error handler los oculta.
                // Aqu√≠ simplificamos asumiendo que el usuario pondr√° los archivos correctos.
                
                currentIndex = nextIndex;
                const nextSlide = slides[currentIndex];
                
                // Si el slide est√° oculto (error), saltar r√°pido
                if(nextSlide.style.display === 'none') {
                     // Recursi√≥n segura con timeout m√≠nimo
                     setTimeout(showNextSlide, 50);
                     return;
                }

                nextSlide.classList.add('active');
                
                // Programar el SIGUIENTE cambio seg√∫n el tipo de este slide
                scheduleNextSlide();
            }

            function scheduleNextSlide() {
                if(!isOpened) return; // Seguridad

                const currentSlide = slides[currentIndex];
                
                // Limpiar cualquier timeout previo
                if(slideTimeout) clearTimeout(slideTimeout);

                if (currentSlide.tagName === 'VIDEO') {
                    // SI ES VIDEO: Reproducir y esperar a que termine
                    currentSlide.play().then(() => {
                        // Cuando termine, llamar a showNextSlide
                        currentSlide.onended = () => {
                            showNextSlide();
                        };
                    }).catch(e => {
                        console.log("Error playing video, skipping", e);
                        // Si falla (ej. formato), saltar en 2 seg
                        slideTimeout = setTimeout(showNextSlide, 2000);
                    });
                } else {
                    // SI ES FOTO: Esperar 5 segundos
                    slideTimeout = setTimeout(showNextSlide, 5000);
                }
            }

            // Swipe Logic (Manual)
            let touchStartX = 0;
            let touchEndX = 0;

            track.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
                if(slideTimeout) clearTimeout(slideTimeout); // Pausar autom√°tico
            }, {passive: true});

            track.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, {passive: true});
            
            function handleSwipe() {
                const swipeThreshold = 50;
                if (touchEndX < touchStartX - swipeThreshold) {
                    // Swipe Izquierda (Siguiente)
                    // Forzamos el cambio inmediato, el cual reprogramar√° el siguiente
                    // Detenemos el video actual si suena
                    const currentSlide = slides[currentIndex];
                    if(currentSlide.tagName === 'VIDEO') {
                        currentSlide.pause();
                        currentSlide.currentTime = 0;
                        currentSlide.onended = null; // Quitar listener
                    }
                    showNextSlide();
                }
                // (Opcional: Swipe Derecha para anterior, pero complica la l√≥gica de videos
                //  as√≠ que mantenemos solo avance para simplicidad y fluidez)
            }

            function createConfettiHearts() {
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        const heart = document.createElement("div");
                        heart.innerHTML = "üíñ";
                        heart.style.position = "fixed";
                        heart.style.left = Math.random() * 100 + "%";
                        heart.style.top = "-10px";
                        heart.style.fontSize = (Math.random() * 20 + 10) + "px";
                        heart.style.zIndex = "1000";
                        heart.style.animation = `floatBackground 3s linear forwards`;
                        document.body.appendChild(heart);
                        setTimeout(() => heart.remove(), 3000);
                    }, i * 100);
                }
            }
        });
    </script>
</body>
</html>